import{a as Q,d as T,u as F,o as B,b as q,c as g,e,t as h,f,r as v,w as Y,g as Z,h as o,i as k,v as x,j as ee,k as te,l as le,m as H,F as I,n as j,p as V,q as z}from"./index-CC4I0ac1.js";import{M as W}from"./bootstrap.esm-G50tnjl1.js";const oe="https://ec-course-api.hexschool.io",D="abbie-ts",C=Q.create({baseURL:oe});C.interceptors.request.use(l=>{const a=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");return a&&(l.headers.Authorization=a),l},l=>Promise.reject(l));C.interceptors.response.use(l=>Promise.resolve(l),l=>Promise.reject(l.response.data));const se=l=>C.get(`/v2/api/${D}/admin/products`,{params:l}),ae=l=>C.post(`/v2/api/${D}/admin/product`,{data:l}),ne=l=>{const{data:a,id:p}=l;return C.put(`/v2/api/${D}/admin/product/${p}`,{data:a})},ie=l=>C.delete(`/v2/api/${D}/admin/product/${l}`),de=async l=>C.post(`/v2/api/${D}/admin/upload`,l),re={class:"modal-dialog modal-dialog-centered modal-sm"},ue={class:"modal-content rounded-lg"},ce={class:"modal-header"},me={class:"modal-title",id:"deleteModalLabel"},pe={class:"modal-body text-center"},be={id:"deleteModalMessage"},ge=T({__name:"DeleteModal",props:{title:{},content:{}},setup(l,{expose:a}){const p=F("modalRef");let n=null,r=null;B(()=>{p.value&&(n=new W(p.value))}),q(()=>{n&&n.dispose()});const u=i=>{n&&(n.show(),r=i)},y=()=>{n&&n.hide()},$=()=>{r&&(r(),y())};return a({openModal:u,closeModal:y}),(i,_)=>(f(),g("div",{ref_key:"modalRef",ref:p,class:"modal fade",id:"deleteModal",tabindex:"-1","aria-labelledby":"deleteModalLabel","aria-hidden":"true"},[e("div",re,[e("div",ue,[e("div",ce,[e("h5",me,h(l.title),1),_[0]||(_[0]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",pe,[e("p",be,h(l.content),1)]),e("div",{class:"modal-footer d-flex justify-content-center"},[_[1]||(_[1]=e("button",{type:"button",class:"btn btn-outline-secondary rounded-lg","data-bs-dismiss":"modal"}," 取消 ",-1)),e("button",{onClick:$,type:"button",class:"btn btn-danger rounded-lg",id:"confirmDeleteBtn"}," 確認 ")])])])],512))}}),R=4;function fe(l){try{const a=new URL(l);return["http:","https:"].includes(a.protocol)}catch{return!1}}async function ve(l){const a=new FormData;a.append("file-to-upload",l);try{return(await de(a)).data.imageUrl}catch(p){throw alert("上傳圖片失敗"),p}}function _e(l=[]){const a=v([...l]),p=v(""),n=v("未選擇檔案。"),r=v(null),u=v(!1);return{uploadedImages:a,imageUrlInput:p,fileNameDisplay:n,fileToUpload:r,isUploading:u,addImageUrl:()=>{const m=p.value.trim();if(m){if(a.value.length>=R){alert(`最多只能上傳 ${R} 張圖片`);return}if(!fe(m)){alert("請輸入有效的圖片 URL 格式 (需包含 http:// 或 https://)");return}a.value.push(m),p.value=""}},handleFileChange:m=>{const d=m.target,c=d.files?.[0];if(d.value="",!c){n.value="未選擇檔案。",r.value=null;return}if(!c.type.startsWith("image/")){alert("請選擇有效的圖片檔案！"),n.value="未選擇檔案。",r.value=null;return}if(a.value.length>=R){alert(`最多只能上傳 ${R} 張圖片！`),n.value="圖片數量已達上限，請先刪除圖片。",r.value=null;return}r.value=c,n.value=c.name},triggerUpload:async()=>{const m=r.value;if(!m){alert("請先選擇圖片檔案");return}if(!u.value)try{u.value=!0;const d=await ve(m);a.value.push(d),r.value=null,n.value="未選擇檔案。",alert("圖片上傳成功！")}catch(d){console.error("圖片上傳失敗:",d),alert("圖片上傳失敗，請稍後再試。")}finally{u.value=!1}},deleteImage:m=>{a.value.splice(m,1)},resetImages:(m=[])=>{a.value=[...m].filter(Boolean),p.value="",n.value="未選擇檔案。",r.value=null,u.value=!1}}}const O=()=>({id:"",title:"",origin_price:0,price:0,category:"",unit:"",num:0,content:"",description:"",is_enabled:1,imageUrl:"",imagesUrl:[""]});function he(){const l=v(O()),a=v("新增商品"),p=r=>{r?(l.value={...r},a.value="編輯商品"):n()},n=()=>{l.value=O(),a.value="新增商品"};return{form:l,formTitle:a,loadProduct:p,resetForm:n}}const ye={class:"modal-dialog modal-dialog-centered modal-lg"},Ue={class:"modal-content rounded-lg"},ke={class:"modal-header"},$e={class:"modal-title",id:"addNewProductModalLabel"},xe={class:"modal-body"},we={class:"row"},Ce={class:"col-md-6"},Me={class:"mb-3"},Pe={class:"row"},Ie={class:"col-6 mb-3"},De={class:"col-6 mb-3"},Re={class:"row"},Ve={class:"col-6 mb-3"},Fe={class:"col-6 mb-3"},je={class:"mb-3"},Le={class:"mb-3"},Ne={class:"mb-3 d-flex align-items-center"},Se={class:"form-check form-switch"},Te={class:"col-md-6"},Be={class:"mb-3"},Ae={class:"input-group mb-2"},Ee=["disabled"],Ge={class:"input-group mb-2"},ze={class:"file-name-display form-control rounded-lg"},Oe=["disabled"],qe={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},He={class:"mb-3"},We={id:"imagesContainer",class:"d-flex flex-wrap gap-2"},Xe=["src"],Je=["onClick"],Ke=["src"],Qe={class:"modal-footer"},Ye=["disabled"],Ze=T({__name:"ProductModal",props:{product:{}},emits:["get-products"],setup(l,{expose:a,emit:p}){const n=p,r=F("modalRef");let u=null;B(()=>{r.value&&(u=new W(r.value))}),q(()=>{u&&u.dispose()});const y=()=>{u&&u.show()},$=()=>{u&&u.hide()},{form:i,formTitle:_,loadProduct:P}=he(),{uploadedImages:m,imageUrlInput:d,fileToUpload:c,fileNameDisplay:b,isUploading:M,addImageUrl:A,triggerUpload:E,handleFileChange:G,deleteImage:X,resetImages:L}=_e();Y(()=>l.product,w=>{w.id?(P(w),L([w.imageUrl,...w.imagesUrl])):(P(null),L([]))},{immediate:!0,deep:!0});const J=Z(()=>!!l.product.id),N=v(!1),K=async()=>{const[w,...t]=m.value,{id:s,...U}=i.value;U.imageUrl=w,U.imagesUrl=t;const S={...U,imagesUrl:U.imagesUrl?U.imagesUrl:[""]};N.value=!0;try{J.value&&s?await ne({data:S,id:s}):await ae(S),L([]),$()}catch{alert("新增/編輯產品失敗")}finally{N.value=!1,n("get-products")}};return a({openModal:y,closeModal:$}),(w,t)=>(f(),g("div",{ref_key:"modalRef",ref:r,class:"modal fade",id:"addNewProductModal",tabindex:"-1","aria-labelledby":"addNewProductModalLabel","aria-hidden":"true"},[e("div",ye,[e("div",Ue,[e("div",ke,[e("h5",$e,h(o(_)),1),e("button",{onClick:$,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]),e("div",xe,[e("div",we,[e("div",Ce,[e("form",null,[e("div",Me,[t[12]||(t[12]=e("label",{for:"productName",class:"form-label"},"商品名稱",-1)),k(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>o(i).title=s),type:"text",class:"form-control rounded-lg",id:"productName"},null,512),[[x,o(i).title]])]),e("div",Pe,[e("div",Ie,[t[13]||(t[13]=e("label",{for:"productOriginalPrice",class:"form-label"},"原價",-1)),k(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>o(i).origin_price=s),type:"number",class:"form-control rounded-lg",id:"productOriginalPrice"},null,512),[[x,o(i).origin_price]])]),e("div",De,[t[14]||(t[14]=e("label",{for:"productPrice",class:"form-label"},"售價",-1)),k(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>o(i).price=s),type:"number",class:"form-control rounded-lg",id:"productPrice"},null,512),[[x,o(i).price]])])]),e("div",Re,[e("div",Ve,[t[15]||(t[15]=e("label",{for:"productCategory",class:"form-label"},"分類",-1)),k(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>o(i).category=s),class:"form-control rounded-lg",id:"productCategory"},null,512),[[x,o(i).category]])]),e("div",Fe,[t[16]||(t[16]=e("label",{for:"productUnit",class:"form-label"},"單位",-1)),k(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>o(i).unit=s),class:"form-control rounded-lg",id:"productUnit"},null,512),[[x,o(i).unit]])])]),e("div",je,[t[17]||(t[17]=e("label",{for:"productDescription",class:"form-label"},"商品內容",-1)),k(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=s=>o(i).content=s),class:"form-control rounded-lg",id:"productDescription",rows:"4"},null,512),[[x,o(i).content]])]),e("div",Le,[t[18]||(t[18]=e("label",{for:"productDescription",class:"form-label"},"商品描述",-1)),k(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=s=>o(i).description=s),class:"form-control rounded-lg",id:"productDescription",rows:"4"},null,512),[[x,o(i).description]])]),e("div",Ne,[t[19]||(t[19]=e("label",{class:"form-label me-3 mb-0"},"啟用",-1)),e("div",Se,[k(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>o(i).is_enabled=s),class:"form-check-input",type:"checkbox",id:"flexSwitchProductEnable","true-value":1,"false-value":0},null,512),[[ee,o(i).is_enabled]])])])])]),e("div",Te,[e("div",Be,[t[21]||(t[21]=e("label",{class:"form-label"},"上傳圖片 (最多 4 張)",-1)),e("div",Ae,[k(e("input",{type:"url",class:"form-control rounded-lg",placeholder:"輸入圖片連結","onUpdate:modelValue":t[8]||(t[8]=s=>te(d)?d.value=s:null)},null,512),[[x,o(d)]]),e("button",{class:"btn btn-outline-secondary rounded-lg ms-2",type:"button",onClick:t[9]||(t[9]=(...s)=>o(A)&&o(A)(...s)),disabled:o(m).length>=4}," 新增連結 ",8,Ee)]),e("div",Ge,[t[20]||(t[20]=e("label",{class:"input-group-text rounded-lg",for:"imageInputFile"},"瀏覽...",-1)),e("input",{onChange:t[10]||(t[10]=(...s)=>o(G)&&o(G)(...s)),type:"file",class:"form-control d-none",id:"imageInputFile",accept:".jpg, .jpeg, .png"},null,32),e("div",ze,h(o(b)),1),e("button",{onClick:t[11]||(t[11]=(...s)=>o(E)&&o(E)(...s)),disabled:!o(c)||o(M)||o(m).length>=4,class:"btn btn-outline-secondary rounded-lg ms-2",type:"button"},[o(M)?(f(),g("span",qe)):le("",!0),H(" "+h(o(M)?"上傳中...":"上傳圖片"),1)],8,Oe)])]),e("div",He,[t[23]||(t[23]=e("div",{class:"d-flex justify-content-between align-items-center mb-2"},[e("label",{class:"form-label mb-0"},"已上傳圖片")],-1)),e("div",We,[(f(!0),g(I,null,j(o(m),(s,U)=>(f(),g("div",{key:U,class:V(["image-preview-thumbnail-container",{"main-image":U===0}])},[e("img",{src:s,class:"image-preview-thumbnail",alt:"商品圖片預覽"},null,8,Xe),e("button",{class:"btn btn-danger btn-sm delete-btn",onClick:S=>o(X)(U)},[...t[22]||(t[22]=[e("i",{class:"fas fa-times"},null,-1)])],8,Je)],2))),128)),(f(!0),g(I,null,j(4-o(m).length,s=>(f(),g("div",{key:"placeholder-"+s,class:"image-preview-thumbnail-container"},[e("img",{src:`https://placehold.co/100x100/e9ecef/adb5bd?text=Image+${o(m).length+s}`,class:"image-preview-thumbnail"},null,8,Ke)]))),128))])])])])]),e("div",Qe,[e("button",{onClick:$,type:"button",class:"btn btn-outline-secondary rounded-lg"}," 取消 "),e("button",{onClick:K,disabled:N.value,type:"button",class:"btn btn-dark rounded-lg"}," 儲存 ",8,Ye)])])])],512))}}),et={class:"d-flex justify-content-end align-items-center mb-4"},tt={class:"card shadow-sm rounded-lg flex-grow-1"},lt={class:"card-body p-4"},ot={class:"table-responsive"},st={class:"table table-hover align-middle"},at={class:"text-center"},nt={class:"form-check form-switch d-flex justify-content-center align-items-center"},it=["checked"],dt={class:"text-nowrap"},rt=["onClick"],ut=["onClick"],ct={class:"d-flex justify-content-center mt-4"},mt={class:"pagination"},pt={class:"page-item"},bt=["disabled"],gt=["onClick","disabled"],ft={class:"page-item"},vt=["disabled"],Ut=T({__name:"ProductManagement",setup(l){const a=F("productModalRef"),p=F("deleteModalRef"),n=v("1"),r=v([]),u=v({total_pages:0,current_page:0,has_pre:!1,has_next:!1,category:""}),y=async()=>{try{const d=await se({page:n.value});r.value=d.data.products,u.value=d.data.pagination}catch{alert("取得產品列表失敗")}};B(()=>{y()});const i=v({id:"",title:"",origin_price:0,price:0,category:"",unit:"",num:0,content:"",description:"",is_enabled:1,imageUrl:"",imagesUrl:[""]}),_=(d=null)=>{d&&(i.value={...d,imagesUrl:d.imagesUrl?[...d.imagesUrl]:[""]}),a.value?.openModal()},P=d=>{p.value?.openModal(()=>m(d))},m=async d=>{try{await ie(d)}catch{alert("刪除商品失敗")}finally{y()}};return(d,c)=>(f(),g(I,null,[e("div",et,[e("button",{onClick:c[0]||(c[0]=b=>_(null)),type:"button",class:"btn btn-dark rounded-lg px-4 py-2"},[...c[3]||(c[3]=[e("i",{class:"fas fa-plus me-2"},null,-1),H("新增商品 ",-1)])])]),e("div",tt,[e("div",lt,[e("div",ot,[e("table",st,[c[4]||(c[4]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"分類"),e("th",{scope:"col"},"商品名稱"),e("th",{scope:"col"},"原價"),e("th",{scope:"col"},"售價"),e("th",{scope:"col",class:"text-center"},"啟用"),e("th",{scope:"col"})])],-1)),e("tbody",null,[(f(!0),g(I,null,j(r.value,b=>(f(),g("tr",{key:b.id},[e("td",null,h(b.category),1),e("td",null,h(b.title),1),e("td",null,h(b.origin_price),1),e("td",null,h(b.price),1),e("td",at,[e("div",nt,[e("input",{readonly:"",class:"form-check-input",style:{"pointer-events":"none"},type:"checkbox",id:"flexSwitchCheckDefault1",checked:!!b.is_enabled},null,8,it)])]),e("td",dt,[e("button",{onClick:M=>_(b),type:"button",class:"btn btn-sm btn-outline-dark rounded-lg me-2"}," 編輯 ",8,rt),e("button",{onClick:M=>P(b.id),type:"button",class:"btn btn-sm btn-outline-danger rounded-lg"}," 刪除 ",8,ut)])]))),128))])])]),e("nav",ct,[e("ul",mt,[e("li",pt,[e("button",{onClick:c[1]||(c[1]=b=>n.value=String(Number(n.value)-1)),disabled:!u.value?.has_pre,type:"button",class:V(["page-link",{disabled:!u.value?.has_pre}]),"aria-label":"Previous"},[...c[5]||(c[5]=[e("span",{"aria-hidden":"true"},"«",-1)])],10,bt)]),(f(!0),g(I,null,j(u.value?.total_pages,b=>(f(),g("li",{class:"page-item",key:b},[e("button",{onClick:M=>n.value=b.toString(),disabled:n.value===b.toString(),type:"button",class:V(["page-link",{active:n.value===b.toString()}])},h(b),11,gt)]))),128)),e("li",ft,[e("button",{onClick:c[2]||(c[2]=b=>n.value=String(Number(n.value)+1)),disabled:!u.value?.has_next,class:V(["page-link",{disabled:!u.value?.has_next}]),type:"button","aria-label":"Next"},[...c[6]||(c[6]=[e("span",{"aria-hidden":"true"},"»",-1)])],10,vt)])])])])]),z(Ze,{ref_key:"productModalRef",ref:a,product:i.value,onGetProducts:y},null,8,["product"]),z(ge,{ref_key:"deleteModalRef",ref:p,title:"刪除商品",content:"確定要刪除該商品嗎？"},null,512)],64))}});export{Ut as default};
